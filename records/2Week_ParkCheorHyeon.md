## Title: [2Week] 박철현

### 미션 요구사항 분석 & 체크리스트

---
[2주차 미션 페이지](https://wiken.io/ken/12201#2%EC%A3%BC%EC%B0%A8)

### 2주차 미션 요약
- [x] (필수미션) 호감표시 할 때 예외처리 케이스 3가지 처리
  - [x] (1)한명의 인스타회원이 다른 인스타회원에게 중복으로 호감표시 불가
  - [x] (2)한명의 인스타회원이 11명 이상의 호감상대 등록 불가
  - [x] (3) (1)이 발생했을 때 기존 사유와 다른 사유로 호감을 표시하는 경우 사유 변경 처리

- [] (선택미션) 네이버 로그인
  - [x] 로그인 기능 구현
  - [] NAVER__00 형태로 저장하도록 데이터 파싱 구현
---

**[접근 방법]**
<br>
- 구현 전
  - 목표 수립 : 필수 미션 100% 구현 도전, 선택 미션 시도
  - 풀이 생각 : 1,3번 문제는 묶어서 해결할 수 있을 것 같고, 2번은 컨트롤러 단에서 막아주면 좋겠다 생각.
  - 선행 작업 : 그램그램 1주차 미션 코드 확인하여 추가 리팩토링
    -> 강사님 코드대로 1주차 코드 변경(기능별 메서드화 목표 수립)
    -> 양방향 관계, Lazy 방식의 이해

    <br>
- 구현 중
  - 시행착오 :
    1) 인스타 멤버 객체에 있는 from, to 리스트를 활용해서 조건을 찾을 수 있다 생각
       -> 리스트 접근을 어떻게 할지 고민하다가 for-each문을 생각하고 구현

    2) (문제발생 1) 수정 전, 후 객체를 리스트에서 빼고 넣는 과정에서 PersistentObjectException 오류 발생
       -> 문제3 상황처럼, 호감 포인트가 다르면 변경할 수 있는 방법을 고민
       -> builder로 만든 엔티티는 toBuilder로 수정된 객체를 만들어주고 save를 해야함을 생각하고 이행
       -> from리스트(사용자가 호감 표시한 리스트)에서 리스트 객체의 값이 변경됐으니 리스트를 지워주고,
       변경된 객체를 넣어줘야겠다 생각
       -> PersistentObjectException 오류 발생, cascade.ALL -> REMOVE로 변경으로 해결
       -> 이유 : ALL로 할 경우 영속성 전파력이 모든 연관 클래스에 되어야 하는데, 호감 타입만 넣고 만들어서 연결된 부분들에 대한 전달 데이터가 없어서 그런듯함..

    3) (문제발생 2) 호감 표시 전, 후의 객체의 값이 save() 이후 동일하게 변하는 현상 발생
       -> 호감 표시 전, 후를 메시지로 출력하기 위해 호감 포인트 변경 전 객체 find,
       호감 포인트 변경 후 객체 modify로 각각 호감 포인트를 가져 왔는데 둘 다 동일한 값 출력 문제
       -> 영속성 컨텍스트는 <id> <객체타입> 으로 구분하여 저장하고 있어, 수정 전-후 객체의 id가 모두 같아서 발생한 문제
       -> save 전에 미리 String 변수로 값 받아서 해결

    4) 문제발생 1, 2를 겪은 결과, 변경 전 객체인 find를 굳이 리스트에서 빼줄 필요가 없어 코드를 지웠고,
       cascade.ALL 설정을 유지해본 뒤 돌려본 결과 잘 돌아간다! (cascade 부분이 완벽하게 이해는 잘 안가긴하는데.. 일단 되니...)

  - 참고 자료 : 구글링, GPT, 개발자 친구..

    <br>
- 구현 결과 : 필수미션 모두 구현 완료
  - (1) 필수미션 : 모두 구현 완료
  - (2) 선택미션 : 네이버 로그인 까지는 구현했으나, JSON형태의 데이터를 파싱하지 못함
    <br>

    <br>
**[특이사항]**

- 아쉬웠던 점
  - 소셜 로그인에 대한 이해 부족인가.. 선택 미션이 너무 어려웠다.
  - 영속성컨텍스트 관련 자료를 많이 찾아봤음에도 아직 너무 어려운 점이 많다.
  - cascade 옵션을 확실히 모르겠는점
  - 멘토님께서 강사님이 힌트 주신 findBy[A]and[B] 방법을 활용하면 쉽게 해결할 수 있을 것이라 했는데, 조금 더 고민해봐야 겠다.
  - 컨트롤러 단에서 최대 호감표시 인원을 넘을 경우 입력 폼을 안보이게 하고 싶었으나, 소셜로그인 연동 안하면 Null 에러발생-> HTML쪽 추가등 하긴 해야할듯..?

- 궁금한 점
  - cascade 옵션의 다른 활용 사례나 안됐던 이유 확실한 이해..

- 리팩토링 시 추가 진행 방향
  - 리스트를 최대한 적게 활용하는 findBy[A]and[B] 방법 적용
  - 컨트롤러단에서 미리 검사하는 등 현재 호감표시가 10명인 상황이라면 등록폼에 접근 못하게 할 수 있는지 고민

**[리펙토링 결과]**

- findBy[A]and[B] 방안 해결 : "_"로 엔티티의 속성까지 접근할 수 있음을 강사님 해설 영상 및 피어리팩토링을 통해 확인
- 리스트 검사할 때 스트림 방식 적용 : 강사님 해설 코드 보고 이해
- 그 외 모두 강사님 코드로 변경(setter -> toBuilder 만 다르게)
  **[느낀점]**
- QueryDSL은 그냥 흘러가듯이 본 것 같음. 추후 재등장 한다면 다시 공부해봐야 할 것 같음
- Naver 로그인 Map 형태로 받아오는거가 조금은 잘 모르겠다.. 소셜 로그인도 추후에 다시 봐야할 것 같음
- 이번 과제를 통해 영속성컨텍스트를 이전보다는 많이 알 수 있어 좋았다. 다음 과제도 필수 미션에 꼭 성공하고 싶다.