## Title: [1Week] 박철현

### 미션 요구사항 분석 & 체크리스트

---
  [1주차 미션 페이지](https://wiken.io/ken/12201#1%EC%A3%BC%EC%B0%A8)

### 1주차 미션 요약
- [x] (필수미션) 호감 상대 삭제
  - [x] 삭제 처리 전 해당 항목에 대한 소유권이 본인(로그인한 사람) 인지 확인
  - [x] 삭제 후 다시 호감 목록 페이지로 돌아오기(rq.redirectWithMsg 사용)
    - [x] 호감 정보 삭제
    - [x] 삭제 후 호감 목록 페이지 돌아오기
- [ ] (선택미션) 구글 로그인
---

**[접근 방법]**
<br>
- 구현 전 : 
  - 목표 수립 : 필수 미션 100% 구현, 선택 미션 시도
  - 선행 작업 : 그램그램 1 ~ 47강 다시 보기 (04.03 13:00 ~ 04.04 23:30)
    -> RsData 등 수업 시간에 들었던 내용을 다시 보니 알지 못해 처음부터 다시 수강
    -> LikeablePerson 엔티티에 ManyToOne 관계를 한번에 이해하지 못함(노트에 적어서 이해)
    -> 카카오 로그인 연동 등 보려고 했으나 생각보다 늦어져 미수강
  
    <br>
- 구현 중 :
  - 참고 자료 : 점프투스프링부트 "3-10 수정과 삭제"
  - 시행착오
    - (해결 방안 고민) id를 인자로 받기에, id로 어떻게 해야 할지 고민하다가 id를 활용해 삭제할 객체(호감 정보)를 찾기고 생각하고 구현
    - (Url 맵핑 오류) 데이터 삭제 후 호감 목록 페이지로 가는 Redirect에 "likeablePerson/delete/" 가 선행되어 목록 페이지가 나오지 않음
      -> 해결 : rq.redirectWithMsg 인자로 절대경로('/')를 포함하지 않음
      -> redirect시 절대 경로가 없을 경우, 원래 경로에서 상대적으로 찾아가기에 필수
    <br>
- 구현 결과
  - 삭제 기능 구현 : DB 삭제 구현 완료, 기존 생각한 방식 구현 완료
    - (1) 삭제하려는 호감 정보와 현재 로그인 한 사람의 정보를 가져온다.
    - (2) 삭제하려는 likeable_person 테이블 내에 from insta id(올린 사람의 인스타 정보)와 로그인 한 사람이 동일한 사람인지 비교
    - (3) (2)의 결과가 동일인이면 삭제, 아닐 경우 오류 메시지 출력
    
    <br>
  - 페이지 이동 구현 : 삭제 후 list 페이지로 이동 
      
    <br>
**[특이사항]**

- 아쉬웠던 점 
  - 절대/상대 경로 문제를 파악 하지 못해 혼자 해결하고자 오래 걸려 구글 로그인 시도도 못해봄
   -> 진작에 멘토님께 여쭤볼껄 하는 아쉬움
  - 시간이 부족하여 카카오 로그인 연동 강의 수강을 못한 점
   -> 금주 내 강의 수강 및 인터넷 검색을 통해 구글 로그인 기능 추가 시도 예정

- 궁금한 점
  - LikeableRepository에 findById를 선언했는데 해당 메소드의 리턴값을 optional로 해야 하는 이유
    - LikeableService 에서 delete 메소드 구현 시, 삭제할 호감표시 정보(객체)를 가져오기 위해 findById를 Repository에서 구현
    - 리턴값을 LikeablePerson으로 하려 했더니, Optional로 해야 한다고 빨간색으로 떠서 불필요한 DataNotFoundException을 점프투스프링에서 가져와 예외 처리를 해줬다.
    - Entity 클래스를 반환 값으로 못하고 Optional을 써야 할지 모르겠다.


- 리팩토링 시 추가 진행 방향
  - (1) get 메소드 사용이 많은데, 임시 지역 변수로 받아서 가독성 높이기 고려 사항
  - (2) LikeableRepository에 findById를 선언했는데 해당 메소드의 리턴값 수정 시도
  - (3) 구글 로그인 기능 추가


  **[리펙토링 결과]**
  - (1) 메모리 낭비를 하지 않기 위해 선언하지 않음
  - (2) 찾지 못하면 null을 반환하도록 유지하기 위해 Optional을 남겨둠
  - (3) 구글 로그인 추가
  - (4) 추가 강의 내용에 따라 양방향 관계 설정
  - (5) 구현한 삭제 기능에서 버그 수정
    - 기존 : if문에 모두 return 값을 줘서 기본 String 리턴값을 어떻게 할지 몰라 그냥 다시 리스트 사이트로 리다이렉트 하려 함
    - 변경 : 조건 충족(작성자==로그인한 사용자) 일 경우를 if문으로 하지 않고 밖으로 뺌
      --> 호감 정보가 없을 경우의 조건을 생각하지 못했어서, 만일 없는 정보였으면 그대로 리스트 페이지로 새로고침되었을 것 같다.
  - (6) 코드 수정
    - 현재 로그인 한 사용자의 객체 얻는 방법 변경 (Principal -> rq.getMember)
    - 호감 정보 객체가 삭제 상태로 가기 전 미리 String 받아두고, 삭제 시 메시지 출력하도록 변경 

**[느낀점]**
  - 직접 코드리뷰를 해보니 뭔가 다른사람 코드를 보니 새로운 느낌이 들었고, 같은 내용을 배웠어도 다르게 짠 다는 것을 다시 한번 느꼈다.
  - 내가 리뷰했던 코드에서 해결책을 찾아 조언해주니 뭔가 뿌듯했다.
  - 강사님 코드로 회고했는데, 몇가지 놓친 부분이 있어 아쉬웠다(if 조건 생각 못한 점...)
  - 구글 로그인도 강사님 영상보고 했지만, 구글링으로 해냈었으면 하는 아쉬움이있다.
  - 다음주 과제에는 좀더 성장한 코드로 수행하고싶다.